name: YandexGPT AI News Monitor

on:
  schedule:
    # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π —á–∞—Å —Å 03:00 –¥–æ 15:00 UTC (06:00-18:00 –ú–°–ö)
    - cron: '0 3-15 * * *'
  workflow_dispatch:
    inputs:
      hour:
        description: '–ß–∞—Å –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (3-15 UTC = 6-18 –ú–°–ö)'
        required: false
        type: choice
        options:
        - 3
        - 4
        - 5
        - 6
        - 7
        - 8
        - 9
        - 10
        - 11
        - 12
        - 13
        - 14
        - 15

jobs:
  publish-hourly-news:
    runs-on: ubuntu-latest
    timeout-minutes: 10  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies from requirements.txt
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Debug info
        run: |
          echo "UTC time: $(date -u)"
          echo "–ú–°–ö time: $(date -d '+3 hours')"
          pip list | grep aiohttp

      - name: Publish AI News
        env:
          YANDEX_API_KEY: ${{ secrets.YANDEX_API_KEY }}
          YANDEX_FOLDER_ID: ${{ secrets.YANDEX_FOLDER_ID }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
        run: |
          echo "üïê –ó–∞–ø—É—Å–∫ –≤ UTC: $(date -u)"
          echo "üïê –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ú–°–ö: $(date -d '+3 hours')"
          python src/main.py
